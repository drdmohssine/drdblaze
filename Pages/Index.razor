@page "/"
@using drdblaze.Shapes;



<div class="input-group mb-3">
    <input type="text" class="form-control" @bind-value="@InputText" placeholder="Rectangle Text" aria-label="Rectangle Text" aria-describedby="button-addon2">
    <button class="btn btn-outline-secondary" type="button" id="button-addon2" @onclick="HandleButtonClick">Add</button>
</div>


    <div style="width:1500px;height:2000px;background-color:lightgray ;overflow:auto">

        @*     @foreach(Rectangle rect in Rectangles)
        {


        <div style="position:absolute;top:@(rect.MC.Position.X)px;left:@(rect.MC.Position.Y)px">
        @rect.Text
        </div>
        }
        *@
        <svg width="1570" height="2000">

            @foreach (Rectangle rect in Rectangles)
            {
                <SNRect RectBack ="RemoveRectangle" Rectangle="@rect" SelectedPoint="SelectPoint" OnMouseDown="StatChanged" OnMouseMove="StatChanged" OnMouseUp="StatChanged">

                </SNRect>


            }

            @foreach (Line line in Lines)
            {
                <SNLine LineBack="RemoveLine" Line="line" Point1="line.Point1" Point2="line.Point2" StrokeColor="@line.Stroke" StrokeWidth="@line.StrokeWidth">
                </SNLine>
            }


        </svg>
    </div>


<ConfirmDialog @ref="dialog" />


@code{

    private ConfirmDialog dialog;

   
    List<Rectangle> Rectangles = new List<Rectangle>();
    List<Line> Lines = new List<Line>();


    private string InputText { get; set; }

     protected override void OnParametersSet()
    {
        base.OnParametersSet();
        StateHasChanged();
    }

    private void HandleButtonClick()
    {
        // Handle button click event here
        Rectangles.Add(
           new Rectangle(10, 10, 200, 40)
               {

                   Fill = "bisque",
                   Text = InputText,

               }
        );

        InputText = "";
    }


    protected override void OnInitialized()
    {

    }

    int pointNumber = 0;
    Point pointN1 = new Point();
    private async Task SelectPoint(Point selectedPoint)
    {
        if(pointNumber == 0)
        {
            pointN1 = selectedPoint;
            pointNumber++ ;
        }else if(pointNumber == 1)
        {
            Lines.Add(
                new Line(pointN1, selectedPoint)
                    {
                        Stroke = "black",
                        StrokeWidth = 2
                    }
            );
            pointNumber = 0;
            pointN1 = new Point();
        }
        else
        {
            pointNumber = 0;
            pointN1 = new Point();
        }

    }

    private async Task RemoveLine(Line line)
    {
        var confirmation = await dialog.ShowAsync(
          title: "Are you sure you want to delete this?",
          message1: "This will delete the record. Once deleted can not be rolled back.",
          message2: "Do you want to proceed?");

        if (confirmation)
        {
            // do whatever
            Lines.Remove(line);
        }
        else
        {
            // do whatever
        }


      

    }
    private async Task RemoveRectangle(Rectangle rectangle)
    {
        var confirmation = await dialog.ShowAsync(
           title: "Are you sure you want to delete this?",
           message1: "This will delete the record. Once deleted can not be rolled back.",
           message2: "Do you want to proceed?");

        if (confirmation)
        {
            // do whatever
            Rectangles.Remove(rectangle);
        }
        else
        {
            // do whatever
        }

      




    }
    private void StatChanged()
    {

        StateHasChanged();
    }

}

